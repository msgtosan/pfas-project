{
  "source_type": "KARVY",
  "description": "Karvy/KFintech CAS Capital Gains Statement column mappings",
  "sheet_names": ["Trasaction_Details", "Transaction_Details"],
  "header_row": 4,
  "file_patterns": ["karvy", "KARVY", "KFintech", "MF_KArvy"],

  "mappings": [
    {
      "source_column": "Fund ",
      "target_field": "fund_code",
      "transform": "strip",
      "required": false
    },
    {
      "source_column": " Fund Name",
      "target_field": "amc_name",
      "transform": "strip",
      "required": false
    },
    {
      "source_column": "Folio Number",
      "target_field": "folio_number",
      "transform": "strip",
      "required": true
    },
    {
      "source_column": "Scheme Name",
      "target_field": "asset_name",
      "transform": "strip",
      "required": true
    },
    {
      "source_column": "Scheme Name",
      "target_field": "asset_identifier",
      "transform": "extract_isin",
      "required": false
    },
    {
      "source_column": "Trxn.Type",
      "target_field": "transaction_type",
      "transform": "upper",
      "required": true,
      "value_mapping": {
        "PURCHASE": "BUY",
        "REDEMPTION": "SELL",
        "SYSTEMATIC INVESTMENT": "BUY",
        "SIP": "BUY",
        "SWITCH IN": "BUY",
        "SWITCH OUT": "SELL",
        "DIVIDEND PAYOUT": "DIVIDEND",
        "DIVIDEND REINVEST": "DIVIDEND_REINVEST"
      }
    },
    {
      "source_column": "Date",
      "target_field": "purchase_date",
      "transform": "parse_date_dmy",
      "required": true
    },
    {
      "source_column": "Current Units",
      "target_field": "quantity",
      "transform": "parse_decimal",
      "required": false
    },
    {
      "source_column": "Original Cost Amount",
      "target_field": "amount",
      "transform": "parse_decimal",
      "required": true
    },
    {
      "source_column": "Original Purchase Cost",
      "target_field": "unit_price",
      "transform": "parse_decimal",
      "required": false
    },
    {
      "source_column": "Date_1",
      "target_field": "redemption_date",
      "transform": "parse_date_dmy",
      "required": false
    },
    {
      "source_column": "RedUnits",
      "target_field": "redeemed_units",
      "transform": "parse_decimal",
      "required": false
    },
    {
      "source_column": "Amount",
      "target_field": "redemption_amount",
      "transform": "parse_decimal",
      "required": false
    },
    {
      "source_column": "Price",
      "target_field": "redemption_nav",
      "transform": "parse_decimal",
      "required": false
    },
    {
      "source_column": "Short Term",
      "target_field": "stcg",
      "transform": "parse_decimal",
      "required": false
    },
    {
      "source_column": "Long Term With Index",
      "target_field": "ltcg_indexed",
      "transform": "parse_decimal",
      "required": false
    },
    {
      "source_column": "Long Term Without Index",
      "target_field": "ltcg_non_indexed",
      "transform": "parse_decimal",
      "required": false
    },
    {
      "source_column": "\u00a0Grandfathered\n\u00a0NAV as on 31/01/2018",
      "target_field": "grandfathered_nav",
      "transform": "parse_decimal",
      "required": false
    },
    {
      "source_column": "GrandFathered Cost Value",
      "target_field": "grandfathered_value",
      "transform": "parse_decimal",
      "required": false
    }
  ],

  "derived_fields": {
    "activity_type": "INVESTING",
    "flow_direction": {
      "BUY": "OUTFLOW",
      "SELL": "INFLOW",
      "DIVIDEND": "INFLOW"
    },
    "source_type": "KARVY",
    "asset_class": "MF_EQUITY"
  },

  "notes": [
    "Karvy CG files have multi-section layout: Section A (Subscriptions), Section B (Outflows), Section C (Gains)",
    "Date column contains purchase date, Date_1 contains redemption date",
    "Column names may have leading/trailing spaces"
  ]
}
